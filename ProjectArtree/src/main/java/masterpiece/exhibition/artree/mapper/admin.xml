<?xml version="1.0" encoding="UTF-8"?>

<!-- ====  mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">

	<!-- tag 가져오기 - categories -->
	<select id="getTypes" resultType="String">
		select distinct type from tag
	</select>
	
	<!-- tag 가져오기 - keywords -->
	<select id="getKeywords" parameterType="String" resultType="String">
		select keyword from tag where type = #{ type }
	</select>
	
	<!-- gallery 가져오기 -->
	<select id="getGalleries" resultType="masterpiece.exhibition.admin.model.GalleryVO">
		select galleryno, location, galleryname, detailaddress, nvl(tel, '-') as tel from Gallery 
		where galleryname != '-'
		order by location, galleryname
	</select>
	
	<!-- gallery location 가져오기 -->
	<select id="getGalleryLocations" resultType="String">
		select distinct location from gallery where location != '-' order by location
	</select>
	
	<!-- gallery 검색 -->
	<select id="wordSearchShow" resultType="masterpiece.exhibition.admin.model.GalleryVO" parameterType="HashMap">
		select galleryno, location, galleryname, detailaddress, nvl(tel, '-') as tel from Gallery 
		where galleryname != '-'
		<if test='searchWord != "" , galleryLocation == ""'>	<!-- 지역을 선택하지 않고 검색어를 입력한 경우 -->
		    and galleryname like '%' || #{ searchWord } || '%' or detailaddress like '%' || #{ searchWord } || '%'
		</if>
		<if test='galleryLocation != "" , searchWord != ""'>	<!-- 지역을 선택하고 또 검색어를 입력한 경우 -->
			and location = #{ galleryLocation } 
			and galleryname like '%' || #{ searchWord } || '%'
		</if>
		<if test='searchWord == "" , galleryLocation == ""'>
		
		</if>
		order by location, galleryname
	</select>
	
	<select id="getApplyingno" resultType="int">
		select seq_appliedExhibits.nextval from dual
	</select>
	
	<insert id="addExhibition" parameterType="HashMap">
		insert into appliedExhibits ( applyingNo, fk_galleryNo, exhibitionName, applier, author, startDate, endDate,
			email, tel, genre, tag, authorInfo, exhibitionInfo, price, foodorDrink, extraRestriction, photo, openCloseTime )
		values ( #{ applyingno }, #{ fk_galleryno }, #{ exhibitionName }, #{ applier }, #{ author }, #{ startDate },
			#{ endDate }, #{ email }, #{ tel }, #{ genre }, #{ tag }, #{ authorInfo }, #{ exhibitionInfo }, #{ price }, #{ foodorDrink },
			#{ extraRestriction }, #{ photo }, #{ openCloseTime } )
	</insert>
	
	<insert id="addExhibitImage" parameterType="HashMap">
		insert into appliedDetail(appliedimgseq, fk_applyingNo, imagefilename, imageorgFilename, imagefileSize, imageInfo, thumbnailFileName) 
		values( seq_appliedDetail.nextval, #{ fk_applyingno }, #{ imagefilename },
			#{ imageorgfilename }, #{ imagefilesize }, #{ imageinfo }, #{ thumbnailfilename } )
	</insert>
	
	<!-- 전시회목록 가져오기 -->
	<select id="getExhibitionList" resultType="masterpiece.exhibition.exhibits.model.ExhibitsVO">
		select exhibitionno, exhibitionname, author, status from exhibition where status = '전시중'
	</select>
	
	<!-- 전시회정보 가져오기 -->
	<resultMap type="HashMap" id="getExhibitionDetailMap">
		<result property="exhibitionno" 	column="exhibitionno" 		javaType="String" />
		<result property="exhibitionname" 	column="exhibitionname" 	javaType="String" />
		<result property="author" 			column="author" 			javaType="String" />
		<result property="status" 			column="status" 			javaType="String" />
		<result property="galleryname" 		column="galleryname" 		javaType="String" />
		<result property="applier" 			column="applier" 			javaType="String" />
		<result property="tel" 				column="tel" 				javaType="String" />
		<result property="email" 			column="email" 				javaType="String" />
		<result property="startdate" 		column="startdate" 			javaType="String" />
		<result property="enddate" 			column="enddate" 			javaType="String" />
		<result property="genre" 			column="genre" 				javaType="String" />
		<result property="tag" 				column="tag" 				javaType="String" />
		<result property="exhibitioninfo" 	column="exhibitioninfo" 	javaType="String" />
		<result property="price" 			column="price" 				javaType="String" />
		<result property="foodordrink" 		column="foodordrink" 		javaType="String" />
		<result property="extrarestriction" column="extrarestriction" 	javaType="String" />
		<result property="photo" 			column="photo" 				javaType="String" />
		<result property="openclosetime" 	column="openclosetime" 		javaType="String" />
		<result property="image1" 			column="image1" 			javaType="String" />
		<result property="image2" 			column="image2" 			javaType="String" />
		<result property="image3" 			column="image3" 			javaType="String" />
		<result property="mainposter" 		column="mainposter" 		javaType="String" />
		<result property="image1info" 		column="image1info" 		javaType="String" />
		<result property="image2info" 		column="image2info" 		javaType="String" />
		<result property="image3info" 		column="image3info" 		javaType="String" />
	</resultMap>
	<select id="getExhibitionDetail" resultMap="getExhibitionDetailMap" parameterType="String">
		select E.exhibitionno, E.exhibitionname, E.author, E.status, G.galleryname
			, E.applier, E.tel, E.email, E.startdate, E.enddate, E.genre, E.tag
			, E.exhibitioninfo, E.price, E.foodordrink, E.extrarestriction, E.photo, E.openclosetime
			, nvl(ED.mainposter, '없음') AS mainposter
			, nvl(ED.image1, '없음') AS image1, nvl(ED.image2, '없음') AS image2, nvl(ED.image3, '없음') AS image3
            , nvl(ED.image1info, '없음') AS image1info, nvl(ED.image2info, '없음') AS image2info, nvl(ED.image3info, '없음') AS image3info
		from exhibition E 
        JOIN gallery G on E.fk_galleryno = G.galleryno
        JOIN exhibitiondetail ED on E.exhibitionno = ED.fk_exhibitionno
        where E.exhibitionno = #{ no }
	</select>

</mapper>
